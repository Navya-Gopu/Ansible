--- 
- name: Obtain ServiceNow Token
 # hosts: localhost
 # gather_facts: no
  
  

  tasks:
  - name: Get token from servicenow
    uri:
     url: "https://ipaastest-apis.eu1.ccp.capgemini.com/token"
     method: POST
     headers:
      Content-Type: "application/x-www-form-urlencoded"
     body_format: form-urlencoded 
     body: 
      grant_type: "client_credentials"
      client_id: "InSjKoAdUmsMMGiifCo1QTZAhp4a"
      client_secret: "XuKN3XLWbfT1AGFpI3fsek5HOxwa"
     
    register: response

  - name: Extract token from api response
    set_fact:
     servicenow_token: "{{ response.json.access_token }}"
 # - name: Store token in a variable file
  #  copy:
    # content: "{{ servicenow_token }}"
     
    # dest: "bearertoken.yaml"
      
