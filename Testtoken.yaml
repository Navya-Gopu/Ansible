--- 
#- name: Obtain ServiceNow Token
 # hosts: localhost
  #tasks:
   - name: Retrive creds
     set_fact:
       api_client_id: "{{ ansible_user }}"
       api_client_secret: "{{ ansible_password}}"
       
   - name: Get token from servicenow
     uri:
    
       url: "{{ token_url }}"
       method: POST
       headers:
        Content-Type: "application/x-www-form-urlencoded"
       body_format: form-urlencoded 
       body: 
        grant_type: "client_credentials"
       # client_id: "{{ token_client_id }}"
       # client_secret: "{{ token_client_secret }}"
        client_id: "{{ api_client_id }}"
        client_secret: "{{ api_client_secret }}"
     
     register: response

   - name: Extract token from api response
     set_fact:
      servicenow_token: "{{ response.json.access_token }}"
      debug:
       var: servicenow_token
      
